#!/bin/bash
set -e

echo "Building WASM malware analyzer module..."

# Build optimized WASM module
cargo build --target wasm32-unknown-unknown --release

# Create assets directory if it doesn't exist
mkdir -p ../../assets

# Copy to Sentinel assets
cp target/wasm32-unknown-unknown/release/malware_analyzer_wasm.wasm \
   ../../assets/malware_analyzer.wasm

echo ""
echo "✓ Build complete"
echo ""

# Print module size
echo "Module size:"
ls -lh ../../assets/malware_analyzer.wasm

echo ""
echo "Module info:"
echo "  Location: Services/Sentinel/assets/malware_analyzer.wasm"
echo "  Version:  0.5.0"
echo ""

# Verify exports
echo "Exports:"
if command -v wasm-tools &> /dev/null; then
    wasm-tools print ../../assets/malware_analyzer.wasm 2>&1 | grep "export" || true
else
    echo "  (install wasm-tools to verify exports)"
fi

echo ""
echo "✓ Module ready for integration with WasmExecutor"
