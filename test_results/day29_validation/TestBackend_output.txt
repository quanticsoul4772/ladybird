PolicyGraph: Cleaning up threats older than 30 days (cutoff: 1759267352000)
====================================
  Backend Components Tests
  (Phase 5 Days 29-30)
====================================
✅ PolicyGraph initialized at /tmp/sentinel_backend_test

=== Test 1: PolicyGraph CRUD Operations ===
  Created Block policy ID: 1
  Created Quarantine policy ID: 2
  Created Allow policy ID: 3
  READ: Verified block policy
  READ: Verified quarantine policy
  UPDATE: Successfully changed policy action and URL pattern
  LIST: Found 3 policies
  DELETE: Successfully removed policy ID 3
✅ PASSED: PolicyGraph CRUD Operations

=== Test 2: Policy Matching Accuracy ===
  ✓ Exact hash match (priority 1): Policy ID 4
  ✓ URL pattern match (priority 2): Policy ID 5
  ✓ Rule name match (priority 3): Policy ID 6
  ✓ No match scenario: Correctly returned no policy
✅ PASSED: Policy Matching Accuracy

=== Test 3: Cache Effectiveness ===
  First match (cache miss): Policy ID 7
  Second match (cache hit): Policy ID 7
  Repeated 10 matches: All returned correct cached policy
✅ PASSED: Cache Effectiveness

=== Test 4: Threat History and Statistics ===
  Initial threat count: 0
  Recorded 5 threats
  New threat count: 5 (increased by at least 5)
  Retrieved 5 threats for 'History_Test_Rule'
  Verified history ordered by detection time (newest first)
  Total threats in history: 5
✅ PASSED: Threat History and Statistics

=== Test 5: Database Maintenance ===
  Initial policy count: 6
  Created expired policy ID: 8
  Created active policy ID: 9
  Cleaned up expired policies
  Verified expired policy was removed
❌ FAILED: Verify Active Exists - Active policy was incorrectly removed

====================================
  Test Summary
====================================
  Passed: 4
  Failed: 1
  Total:  5
====================================

❌ Some tests FAILED
